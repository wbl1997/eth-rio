<launch>
  <arg name="nodelet_manager_on" default="true" />
  <arg name="nodelet_manager_name" default="rio_nodelet_manager" />

  <arg name="rio_queue_size" default="1" />
  <arg name="rio_odom_frame_id" default="odom" />

  <!-- IMPORTANT: must match IMU header.frame_id on /imu/data_raw & /imu/data -->
  <arg name="imu_frame_id" default="imu_frame" />

  <!-- We use a synthetic radar frame to avoid conflicts with frames published in the bag's /tf -->
  <arg name="radar_frame_id" default="ntu_radar" />

  <arg name="visualize" default="true" />

  <node pkg="nodelet" type="nodelet" name="$(arg nodelet_manager_name)" args="manager" cwd="node" output="screen" if="$(arg nodelet_manager_on)"/>

  <node pkg="nodelet" type="nodelet" name="rio" args="load rio::RioNodelet $(arg nodelet_manager_name)" output="screen">
    <rosparam file="$(find rio)/cfg/rio_ntu4dradlm.yaml" />
    <param name="queue_size" value="$(arg rio_queue_size)"/>
    <param name="odom_frame_id" value="$(arg rio_odom_frame_id)"/>
  </node>

  <!-- Minimal extrinsic: IMU -> Radar (identity). Replace with your calibrated values if available. -->
  <node name="imu_to_radar_broadcaster" pkg="tf2_ros" type="static_transform_publisher"
        args="0.144833392062300 0.00279433365385236 0.135302167277064 0.04577 -0.00210 0.00483 0.99895 $(arg imu_frame_id) $(arg radar_frame_id)"/>

  <group if="$(arg visualize)">
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find rio)/cfg/rviz.rviz"/>
    <node pkg="rqt_multiplot" type="rqt_multiplot" name="rqt_multiplot" args="--multiplot-config $(find rio)/cfg/rio_multiplot.xml --multiplot-run-all"/>
  </group>
</launch>